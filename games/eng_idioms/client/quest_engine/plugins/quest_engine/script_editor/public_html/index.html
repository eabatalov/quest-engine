<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html class="html">
    <head>
        <title>Quest script editor</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
        }
        </style>
        <link rel="stylesheet" type="text/css" href="style/index.css" id="pagesheet"/>
        <script src="js/libs/jquery/jquery.js"></script>
        <script src="js/angular.js"></script>
        <script src="js/libs/pixi.js-1.5.1/bin/pixi.dev.js"></script>
        <script src="js/quest_engine/quest_scripting.js"></script>
        <script src="js/se_node.js"></script>
        <script src="js/se_cond.js"></script>
        <script src="js/se_toolbar.js"></script>
        <script src="js/se_tree.js"></script>
        <script src="js/se.js"></script>
        <script src="js/se_ng_app.js"></script>
    </head>
    <body>
        <canvas id="scriptEditorCanvas" style="position: absolute; height: 100%;">
        </canvas>
        <div id="propsDiv" class="win8" style="position: absolute;"
            ng-controller="ScriptEditorPropertiesWindowController">

            <div ng-show="cond !== null">

                <div>
                    <label for="id">Condition type</label>
                    <div>
                        <select ng-model="cond.type" ng-change="condTypeChanged()"
                            ng-options="type.id as type.title for type in condTypes"></select>
                    </div>
                </div>

                <div ng-show="cond.props.id | hasFieldValue">
                    <label for="id">Object</label>
                    <div>
                        <select ng-model="cond.props.id"
                            ng-options="obj for obj in scriptEditor.treeEditor.nodes.stages[0].props.objs"></select>
                    </div>
                </div>
            </div>

            <div ng-show="node !== null">
                <div ng-show="node.props.name | hasFieldValue">
                    <label for="name">Name</label>
                    <div>
                        <input type="text" name="name" ng-model="node.props.name" placeholder="TYPE STAGE NAME" autofocus/>
                    </div>
                </div>

                <div ng-show="node.props.id | hasFieldValue">
                    <label for="id">Object</label>
                    <div>
                        <select ng-model="node.props.id"
                            ng-options="obj for obj in scriptEditor.treeEditor.nodes.stages[0].props.objs"></select>
                    </div>
                </div>

                <div ng-show="node.props.secs  | hasFieldValue">
                    <label for="secs">Seconds</label>
                    <div>
                        <input type="text" name="secs" ng-model="node.props.secs" placeholder="SECONDS TO WAIT" autofocus/>
                    </div>
                </div>

                <div ng-show="node.props.text  | hasFieldValue">
                    <label for="text">Text</label>
                    <div>
                        <input type="text" name="text" ng-model="node.props.text" placeholder="PHRASE/QUIZ TEXT" autofocus/>
                    </div>
                </div>

                <div ng-show="node.props.ans1  | hasFieldValue">
                    <label for="ans1">Answer 1</label>
                    <div>
                        <input type="text" name="ans1" ng-model="node.props.ans1" placeholder="ANSWER OPTION 1" autofocus/>
                    </div>
                </div>

                <div ng-show="node.props.ans2  | hasFieldValue">
                    <label for="ans2">Answer 2</label>
                    <div>
                        <input type="text" name="ans2" ng-model="node.props.ans2" placeholder="ANSWER OPTION 2" autofocus/>
                    </div>
                </div>

                <div ng-show="node.props.ans3  | hasFieldValue">
                    <label for="ans3">Answer 3</label>
                    <div>
                        <input type="text" name="ans3" ng-model="node.props.ans3" placeholder="ANSWER OPTION 3" autofocus/>
                    </div>
                </div>

                <div ng-show="node.props.ans4  | hasFieldValue">
                    <label for="ans4">Answer 4</label>
                    <div>
                        <input type="text" name="ans4" ng-model="node.props.ans4" placeholder="ANSWER OPTION 4" autofocus/>
                    </div>
                </div>

                <div ng-show="node.type === _QUEST_NODE_STORYLINE">
                    <label>Objects</label>
                    <div>
                        <select ng-model="objToAdd"
                            ng-options="obj for obj in scriptEditor.treeEditor.nodes.stages[0].props.objPool"></select>
                        <button ng-click="addObjectToStoryLine()">
                            Add to story line
                        </button>
                        <ul>
                            <li ng-repeat="obj in node.props.objs">
                                {{ obj }}
                            </li>
                        </ul>
                    </div>
                </div>

                <div ng-show="node.type === _QUEST_NODE_STAGE">
                    <label>Objects</label>
                    <div>
                        <input type="text" ng-model="objToAdd" placeholder="Object to add"
                            required ng-maxlength="50"/>
                        <button ng-click="addObjectToStage()">
                            Add to stage
                        </button>
                        <ul>
                            <li ng-repeat="obj in scriptEditor.treeEditor.nodes.stages[0].props.objs">
                                {{ obj }}
                            </li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>

        <script type="text/javascript">
            ScriptEditorPropertiesWindowControllerAppDecl = ['ScriptEditorPropertiesWindowController',
                ['$scope', 'ScriptEditorEvents',
                function($scope, seEvents) {
                    //Make constants accessible from ng attributes
                    $scope._QUEST_NODE_STAGE = _QUEST_NODE_STAGE;
                    $scope._QUEST_NODE_STORYLINE = _QUEST_NODE_STORYLINE;

                    $scope.condTypes = [
                        { id: _QUEST_COND_NONE, title: 'None'},
                        { id: _QUEST_COND_OBJECT_CLICKED, title: 'Object clicked'},
                        { id: _QUEST_COND_ANSWER_1_CLICKED, title: 'Answer 1 clicked'},
                        { id: _QUEST_COND_ANSWER_2_CLICKED, title: 'Answer 2 clicked'},
                        { id: _QUEST_COND_ANSWER_3_CLICKED, title: 'Answer 3 clicked'},
                        { id: _QUEST_COND_ANSWER_4_CLICKED, title: 'Answer 4 clicked'},
                        { id: _QUEST_COND_ANSWER_OTHER_CLICKED, title: 'Answer other clicked'},
                        { id: _QUEST_COND_CONTINUE, title: 'Continue'},
                        { id: _QUEST_COND_DEFAULT, title: 'Default'}
                    ];
                    $scope.objToAdd = null;
                    $scope.seEvents = seEvents;
                    $scope.node = null;
                    $scope.cond = null;

                    $scope.$on('seEvent', function() {
                        $scope.$apply(function() {
                            if (seEvents.args.name === "NODE_PROP_EDIT") {
                                $scope.setPropsObject(seEvents.args.obj, true);
                            } else if (seEvents.args.name === "COND_PROP_EDIT") {
                                $scope.setPropsObject(seEvents.args.obj, false);
                            } else if (seEvents.args.name === "NODE_CREATE") {
                                var scriptAreaGlobalXY = new PIXI.Point(0, 0);
                                scriptAreaGlobalXY.x =
                                    $scope.scriptEditor.panels.script.position.x;
                                scriptAreaGlobalXY.y =
                                    $scope.scriptEditor.panels.script.position.y;
                                var newNodePoint = new PIXI.Point(
                                    seEvents.args.targetPointGlobal.x - scriptAreaGlobalXY.x,
                                    seEvents.args.targetPointGlobal.y - scriptAreaGlobalXY.y
                                );
                                if (newNodePoint. x < 0 || newNodePoint.y < 0) {
                                    return;
                                }
                                var newNode = new SENode(seEvents.args.type);
                                newNode.position = newNodePoint;
                                $scope.scriptEditor.treeEditor.addChild(newNode);
                                $scope.scriptEditor.treeEditor.nodes.all.push(newNode);
                                $scope.setPropsObject(newNode, true);
                                $scope.scriptEditor.updateStage();
                            }
                        });
                    });

                    $scope.addObjectToStoryLine = function() {
                        $scope.node.props.objs.push($scope.objToAdd);
                        $scope.scriptEditor.nodes.stages[0].props.objPool.remove($scope.objToAdd);
                    };

                    $scope.addObjectToStage = function() {
                        $scope.node.props.objs.push($scope.objToAdd);
                        $scope.node.props.objPool.push($scope.objToAdd);
                    };

                    $scope.setPropsObject = function(obj, isNode) {
                        if (isNode) {
                            $scope.node = obj;
                            $scope.cond = null;
                        } else {
                            $scope.node = null;
                            $scope.cond = obj;                            
                        }
                    };

                    $scope.condTypeChanged = function() {
                        $scope.cond.changeType($scope.cond.type);
                    };
                }
            ]];
        </script>
    </body>
</html>